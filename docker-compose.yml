version: "3.7"

services:
  backend:
    build: ./findus-backend
    command: bash -c "python /code/manage.py migrate --noinput && python /code/manage.py runserver 0.0.0.0:8000"
    volumes:
      - ./findus-backend:/code
    restart: always

  frontend:
    build: ./findus-frontend
    volumes:
      - ./findus-frontend:/code
      - /code/node_modules
    # Workaround: https://stackoverflow.com/questions/30043872/docker-compose-node-modules-not-present-in-a-volume-after-npm-install-succeeds
    restart: always

  reverse-proxy:
    build: .
    command: nginx -g 'daemon off;'
    ports:
      - "8000:80"
      - "5000:5000"
    depends_on:
      - frontend
      - backend
    restart: always
